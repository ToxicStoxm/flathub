id: com.toxicstoxm.ledsuite
runtime: org.gnome.Platform
runtime-version: '46'
sdk: org.gnome.Sdk

sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk

finish-args:
  - --share=network
  - --socket=wayland
  - --share=ipc
  - --socket=fallback-x11
  - --device=dri

command: LEDSuite

modules:

  - name: openjdk
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk/install.sh
      - mkdir /app/bin
      - ln -s /app/jre/bin/java /app/bin/java

  - name: ledsuite
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk/gradle/bin/gradle build
      - install -Dm644 build/libs/LEDSuite-*-final.jar /app/LEDSuite.jar
      - install -Dm755 LEDSuite.sh /app/bin/LEDSuite
      - install -Dm644 src/main/resources/metadata/Icons/com.toxicstoxm.ledsuite.svg /app/share/icons/hicolor/scalable/apps/com.toxicstoxm.ledsuite.svg
      - install -Dm644 src/main/resources/metadata/com.toxicstoxm.ledsuite.desktop ${FLATPAK_DEST}/share/applications/com.toxicstoxm.ledsuite.desktop
      - install -Dm644 src/main/resources/metadata/com.toxicstoxm.ledsuite.appdata.xml ${FLATPAK_DEST}/share/appdata/com.toxicstoxm.ledsuite.appdata.xml

    sources:
      - type: archive
        url: https://github.com/ToxicStoxm/LEDSuite/archive/refs/tags/v0.1.3.tar.gz
        sha256: 26ce789593f4ed26e071eb53dd5274b3983f3d27821c704aa2f8e5cb3fb9e20e

      - type: script
        dest-filename: LEDSuite.sh
        commands:
          - exec java --enable-native-access=ALL-UNNAMED -jar /app/LEDSuite.jar "$@"

      - flatpak-sources.json # All the dependencies for the app (generated using "gradle flatpakGradleGenerator")
