id: com.toxicstoxm.ledsuite
runtime: org.gnome.Platform
runtime-version: '46'
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk
finish-args:
  - --share=network
  - --socket=wayland
  - --share=ipc
  - --socket=fallback-x11
  - --device=dri
#build-options:
#  build-args:
#    - --share=network
command: LEDSuite

modules:

  - name: openjdk
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk/install.sh
      - mkdir /app/bin
      - ln -s /app/jre/bin/java /app/bin/java

  - name: ledsuite
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk/gradle/bin/gradle build
      - install -Dm644 build/libs/LEDSuite-*-final.jar /app/LEDSuite.jar
      - install -Dm755 LEDSuite.sh /app/bin/LEDSuite

    sources:
      - type: archive
        url: https://github.com/ToxicStoxm/LEDSuite/archive/refs/tags/v0.1.3.tar.gz
        sha256: 680911586cf67e9f5d654f9b874899809bf06298416defd4f4843d0bdaee25b7

      - type: script
        dest-filename: LEDSuite.sh
        commands:
          - exec java --enable-native-access=ALL-UNNAMED -jar /app/LEDSuite.jar "$@"

      - flatpak-sources.json # All the dependencies for the app (generated using "gradle flatpakGradleGenerator")

  - name: appdata
    buildsystem: simple
    sources:
      - type: file
        path: com.toxicstoxm.ledsuite.desktop

      - type: file
        path: com.toxicstoxm.ledsuite.appdata.xml

      - type: file
        path: com.toxicstoxm.ledsuite.svg

    build-commands:
      - install -Dm644 com.toxicstoxm.ledsuite.svg /app/share/icons/hicolor/scalable/apps/com.toxicstoxm.ledsuite.svg
      - install -Dm644 com.toxicstoxm.ledsuite.desktop ${FLATPAK_DEST}/share/applications/com.toxicstoxm.ledsuite.desktop
      - install -Dm644 com.toxicstoxm.ledsuite.appdata.xml ${FLATPAK_DEST}/share/appdata/com.toxicstoxm.ledsuite.appdata.xml
